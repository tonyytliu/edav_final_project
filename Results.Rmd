---
title: "Results"
date: "12/10/2019"
output: html_document
code_folding: hide
---

```{r, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE, fig.align='center')
library(dplyr)
library(here)
library(ggplot2)
library(ggpubr)
library(scales)
library(mapproj)
library(knitr)
library(ggmosaic)
```

# V. Results

```{r}
load(here("data", "clean", "df_process.RData"))
load(here("data", "clean", "df_rwa.RData"))
load(here("data", "clean", "WorldData.RData"))
```


## 1. Distribution of the number of deaths based on conflict
```{r, fig.width=10}
df_process1<- df_process %>%
              mutate(best_in_1k = best/1000, 
                     name = paste(id, ":", country))
g1 <- ggplot(df_process1, aes(x = best_in_1k)) + 
        geom_histogram(bins = 20, colour = "#80593D", fill = "steelblue") +
        scale_x_continuous(breaks= pretty_breaks()) +
        ggtitle("Distribution of deaths caused by conflict events") +
        labs(x="Best estimated deaths, in thousands (1,000) of deaths")
# only small values
df_process2 <- df_process %>%
              filter(best < 100)
g2<- ggplot(df_process2, aes(x = best)) + 
        geom_histogram(bins = 100, colour = "#80593D", fill = "steelblue") +
        scale_x_continuous(breaks= pretty_breaks()) +
        ggtitle("Distribution of conflicts deaths caused by conflict events",
                subtitle = "with death < 100") +
        labs(x="Best estimated deaths")

df_process3 <- df_process %>%
              filter(best < 20)
g3<- ggplot(df_process3, aes(x = best)) + 
        geom_histogram(bins = 20, colour = "#80593D", fill = "steelblue") +
        scale_x_continuous(breaks= pretty_breaks()) +
        ggtitle("Distribution of conflicts deaths caused by conflict events",
                subtitle = "with death < 20") +
        labs(x="Best estimated deaths")

df_process4<- df_process %>%
              filter(best >= 10000)%>%
              mutate(best_in_1k = best/1000, 
                     name = paste(id, ":", country))
g4<- ggplot(df_process4, aes(x = best_in_1k)) + 
        geom_histogram(bins = 20, colour = "#80593D", fill = "steelblue", boundary=10000) +
        scale_x_continuous(breaks= pretty_breaks()) +
        ggtitle("Distribution of conflicts deaths caused by conflict events",
                subtitle = "with death >= 10,000") +
        labs(x="Best estimated deaths, in thousands (1,000) of deaths")

ggarrange(g1, g2, g3, g4, ncol = 2, nrow = 2)
```

As shown in the top-left plot, the dataset is highly skewed and imbalanced.  When we focus on the data with death less than 100 people, we can see the data are more concentrated in <20 regions. Most conflict events have less than five deaths.


```{r, fig.width=8}
options(scipen = 999)
df_process5<- df_process %>%
              filter(best >= 5000)%>%
              mutate(best_in_1k = best/1000, 
                     name = paste(id, ":", country))

ggplot(df_process5, aes(x = best_in_1k, y = reorder(name, best))) +
      geom_point(color = "steelblue") +
      labs(x="Best estimated deaths, in thousands (1,000) of deaths",
           y="Confict Event ID: Country") + 
      ggtitle("Confict events causing most deaths")
```

The above Cleveland plot shows top conflict events which caused most deaths ($\geq$ 5,000), there is a conflict event happened in Rwanda caused approximately 300,000 deaths, which is much more than other conflicts event. Also, most of those events causing significant fatalities were taken place in Rwanda. 

```{r}
# The conflict with largest death
df_2<- head(df_process[order(-df_process$best),], 10)[c("id", "side_a", "side_b", "year", "best")]
knitr::kable(df_2)
```

After an investigation of those conflict events, we found out most of them are between the Government of Rewanda and civilians, which was related to the [Rwanda genocide](https://en.wikipedia.org/wiki/Rwandan_genocide) in 1994.


## 2. Relation between conflict and time

```{r, fig.width=5, fig.height=3}
df_count <- df_process %>%
            group_by(year) %>%
            tally()
ggplot(df_count, aes(x = year, y = n)) +
      geom_bar(stat = "identity", fill = "steelblue") +
      ggtitle("Number of conflict events based on year") +
      labs(y = "number of conflict events") +
      scale_x_continuous(breaks = round(seq(1990,2018, by = 5),1))
```

As shown in the bar chart, the number of conflict events that occur in each year tends to increase from 1998 to 2018. The number of conflicts is lowest in 1997.

```{r}
# get conflicts' deaths by year
df_sum <- df_process %>%
            group_by(year) %>%
            summarise_at(vars(best), funs(sum))

# get conflicts' deaths by year without the Rwanda genocide
df_sum2 <- df_process %>%
            filter(!(df_process$id %in% df_rwa$id)) %>%
            group_by(year) %>%
            summarise_at(vars(best), funs(sum))
```
```{r, fig.width=10, fig.height=3}
g5<- ggplot(df_sum, aes(x = year, y = best)) +
        geom_bar(stat = "identity", fill = "steelblue") +
        ggtitle("Deaths caused by conflicts based on year") +
        labs(y = "number of deaths") +
        scale_x_continuous(breaks = round(seq(1990,2018, by = 5),1))

g6<- ggplot(df_sum2, aes(x = year, y = best)) +
        geom_bar(stat = "identity", fill = "steelblue") +
        ggtitle("Deaths caused by conflicts based on year",
                subtitle="without the data of the Rwanda genocide") +
        labs(y = "number of deaths") + 
        scale_x_continuous(breaks = round(seq(1990,2018, by = 5),1))

ggarrange(g5, g6, ncol = 2, nrow = 1)
```

The conflict-caused deaths are extremely high in 1994, as shown in the left plot. As mentioned in the previous point,  a high number of deaths were probably related to the Rwanda genocide. When we filter out the data related to the Rwanda genocide, we get the plot on the right. The conflict-caused death per year decreased from 1989 until 2005, after 2005, the number tends to increase.

```{r, fig.width=8, fig.height=3}
df_type <- df_process %>%
              group_by(year, type_of_violence) %>%
              tally()

ggplot(df_type, aes(fill=type_of_violence, x=year, y=n)) + 
    geom_bar(position="dodge", stat="identity") + 
    theme(legend.position='bottom') +
    labs(x="year", y="number of conflict events", fill="violence type") + 
    ggtitle("Number of conflict events based on year and type") +
    scale_x_continuous(breaks = round(seq(1990,2018, by = 5),1))
```

Most conflict events are state-based conflict, i.e., the conflict involved with "[a] government of a state or any opposition organization or alliance of organizations" [[source](https://ucdp.uu.se/downloads/ged/ged191.pdf), pp.28-29], which is higher in number comparing to the other two types of conflict. Before 2018, there are more one-side conflicts (against civilians) than non-state conflicts (between two armed groups).  But in 2018, there are more non-state conflicts compare to one-side conflict. 

If you are interested in the detailed and formal definition of these three types of conflict, please refer to this [source](https://ucdp.uu.se/downloads/ged/ged191.pdf), pp. 28-31.

We want to check further how many civilians deaths each year, compare to the deaths of non-civilians caused by conflicts.

```{r, fig.width=10, fig.height=3.8}
library(tidyverse)

df_civ <- df_process %>%
              group_by(year) %>%
              summarise_at(vars(best, deaths_civilians), funs(sum))%>% 
              mutate(deaths_non_civilians = best-deaths_civilians)%>% 
              select(year, deaths_civilians, deaths_non_civilians) %>% 
              gather(`deaths_civilians`, `deaths_non_civilians`, 
                     key = "section", value = "deaths")

df_civ2 <- df_process %>%
            filter(!(df_process$id %in% df_rwa$id)) %>%
            group_by(year) %>%
            summarise_at(vars(best, deaths_civilians), funs(sum))%>% 
            mutate(deaths_non_civilians = best-deaths_civilians)%>% 
            select(year, deaths_civilians, deaths_non_civilians) %>% 
            gather(`deaths_civilians`, `deaths_non_civilians`, 
                   key = "section", value = "deaths")

              
gc1 <- ggplot(df_civ, aes(fill=section, y=deaths, x=year)) +
        geom_bar(position="stack", stat="identity") + 
        theme(legend.position='bottom') +
        labs(x="year", y="number of deaths", fill="civilian death?") + 
        ggtitle("Deaths caused by conflicts based on year") +
        scale_x_continuous(breaks = round(seq(1990,2018, by = 5),1)) +
        guides(fill = guide_legend(reverse=TRUE)) 

gc2 <- ggplot(df_civ2, aes(fill=section, y=deaths, x=year)) +
        geom_bar(position="stack", stat="identity") + 
        theme(legend.position='bottom') +
        labs(x="year", y="number of deaths", fill="civilian death?") + 
        ggtitle("Deaths caused by conflicts based on year",
                subtitle="without the data of the Rwanda genocide") +
        scale_x_continuous(breaks = round(seq(1990,2018, by = 5),1)) +
        guides(fill = guide_legend(reverse=TRUE)) 

ggarrange(gc1, gc2, ncol = 2, nrow = 1)
```

```{r, fig.width=10, fig.height=6}
df_civ3 <- df_process %>%
              group_by(year) %>%
              summarise_at(vars(best, deaths_civilians), funs(sum))%>% 
              mutate(deaths_civilians = 100*deaths_civilians/best)%>% 
              mutate(deaths_non_civilians = 100-deaths_civilians)%>% 
              select(year, deaths_civilians, deaths_non_civilians) %>% 
              gather(`deaths_civilians`, `deaths_non_civilians`, 
                     key = "section", value = "deaths")
df_civ4 <- df_process %>%
            filter(!(df_process$id %in% df_rwa$id)) %>%
            group_by(year) %>%
            summarise_at(vars(best, deaths_civilians), funs(sum))%>% 
            mutate(deaths_civilians = 100*deaths_civilians/best)%>% 
            mutate(deaths_non_civilians = 100-deaths_civilians)%>% 
            select(year, deaths_civilians, deaths_non_civilians) %>% 
            gather(`deaths_civilians`, `deaths_non_civilians`, 
                   key = "section", value = "deaths")

gc3 <- ggplot(df_civ3, aes(fill=section, y=deaths, x=year)) +
        geom_bar(position="stack", stat="identity") + 
        theme(legend.position='bottom') +
        labs(x="year", y="propotion of total deaths", fill="civilian death?") + 
        ggtitle("Deaths caused by conflicts based on year") +
        coord_flip() +
        scale_x_reverse(breaks = round(seq(1990,2018, by = 5),1)) +
        guides(fill = guide_legend(reverse=TRUE)) 

gc4 <- ggplot(df_civ4, aes(fill=section, y=deaths, x=year)) +
        geom_bar(position="stack", stat="identity") + 
        theme(legend.position='bottom') +
        labs(x="year", y="propotion of total deaths", fill="civilian death?") + 
        ggtitle("Deaths caused by conflicts based on year",
                subtitle="without the data of the Rwanda genocide") +
        coord_flip() +
        scale_x_reverse(breaks = round(seq(1990,2018, by = 5),1)) +
        guides(fill = guide_legend(reverse=TRUE)) 

ggarrange( gc3, gc4, ncol = 2, nrow = 1)
```

```{r}
ttt <- df_process %>%
        filter(year ==1996)

df_3 <- head(ttt[order(-ttt$deaths_civilians),], 10)[c("id", "side_a", "side_b", "year", "deaths_civilians", "country")]
knitr::kable(df_3)
```

From the above plots, the top-left one, we can see that there are large civilians death in conflicts happened in 1994, which potentially because of the Rwanda genocide; after removing the records regarding the Rwanda genocide, the civilian deaths in 1994 was similar with other years. 

The bottom two plots show the proportion of civilian deaths caused by conflicts, by comparing the left and right plots, we can see that the Rwanda genocide is the reason of leading extreme high proportion of civilian deaths.  In most of the years, the percentage of civilian deaths is around 25%, except in the year 1994 and the year 1996. After further checking, the reason for the high proportion of civilian deaths in 1996 is probably due to the [First Congo War](https://en.wikipedia.org/wiki/First_Congo_War).

## Patterns between geographical location and type of violence
Fristly, we want to briefly see the pattern between region and type of violence.
```{r}
p2 <- df_process %>% select(country,region,type_of_violence)

m <- ggplot(p2)+
  geom_mosaic(aes(x=product(type_of_violence,region),fill=type_of_violence,offset=0.02))+
  ggtitle("Mosaic plot for type of violence in different regions")+
  xlab("Regions")+
  ylab("Type of violence")+
  scale_fill_viridis_d()+
  theme_classic() +
  theme(axis.line = element_blank(),axis.ticks = element_blank(),legend.position = "none")+
  theme(plot.title = element_text(face='bold',hjust=0.5))
m

m_2 <- ggplot(p2)+
  geom_mosaic(aes(x=product(region,type_of_violence),fill=region,offset=0.02))+
  ggtitle("Mosaic plot for regions in different types of violence")+
  ylab("Regions")+
  xlab("Type of violence")+
  scale_fill_viridis_d()+
  theme_classic() +
  theme(axis.line = element_blank(),axis.ticks = element_blank(),legend.position = "none")+
  theme(plot.title = element_text(face='bold',hjust=0.5))
  
m_2
```


After anaysis of relation between region and type of violence, we want to 
```{r,fig.height=15}
africa <- p2 %>% filter(region=="Africa")
americas <- p2 %>% filter(region=="Americas")
asia <- p2 %>% filter(region=="Asia")
europe <- p2 %>% filter(region=="Europe")
me <- p2 %>% filter(region=="Middle East")

africa_new <- africa %>% group_by(country,type_of_violence) %>% summarise(Freq=n())
africa_2 <- africa_new %>% group_by(country) %>% mutate(percent = Freq/sum(Freq)) %>% ungroup()
b_1 <- ggplot(africa_2, aes(fill=type_of_violence, y=percent, x=country)) + 
    geom_bar(position="stack", stat="identity")+
    coord_flip()
b_1

americas_new <- americas %>% group_by(country,type_of_violence) %>% summarise(Freq=n())
americas_2 <- americas_new %>% group_by(country) %>% mutate(percent = Freq/sum(Freq)) %>% ungroup()
b_2 <- ggplot(americas_2, aes(fill=type_of_violence, y=percent, x=country)) + 
    geom_bar(position="stack", stat="identity")+
    coord_flip()
b_2

asia_new <- asia %>% group_by(country,type_of_violence) %>% summarise(Freq=n())
asia_2 <- asia_new %>% group_by(country) %>% mutate(percent = Freq/sum(Freq)) %>% ungroup()
b_3 <- ggplot(asia_2, aes(fill=type_of_violence, y=percent, x=country)) + 
    geom_bar(position="stack", stat="identity")+
    coord_flip()
b_3

europe_new <- europe %>% group_by(country,type_of_violence) %>% summarise(Freq=n())
europe_2 <- europe_new %>% group_by(country) %>% mutate(percent = Freq/sum(Freq)) %>% ungroup()
b_4 <- ggplot(europe_2, aes(fill=type_of_violence, y=percent, x=country)) + 
    geom_bar(position="stack", stat="identity")+
    coord_flip()
b_4

me_new <- me %>% group_by(country,type_of_violence) %>% summarise(Freq=n())
me_2 <- me_new %>% group_by(country) %>% mutate(percent = Freq/sum(Freq)) %>% ungroup()
b_5 <- ggplot(me_2, aes(fill=type_of_violence, y=percent, x=country)) + 
    geom_bar(position="stack", stat="identity")+
    coord_flip()
b_5
```


We also plot
```{r,fig.width=15,fig.height=7}
temp6 <- df_process %>% filter(best>0) %>% arrange((best))
ggplot() + 
    geom_map(data = WorldData, map = WorldData,
                  aes(map_id=region),
                  fill = "white", colour = "gray", size=0.5) + 
    geom_point(data=temp6, aes(x=longitude, y=latitude, color=type_of_violence),
               size=0.5, alpha=0.2) +
    coord_map("rectangular", lat0=0, xlim=c(-180,180), ylim=c(-60, 90)) +
    labs(fill="legend", title="Total fatalities caused by conflict event",
         subtitle="based on countries/regions", 
         x="", y="") +
    scale_color_viridis_d()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),axis.text.x = element_blank(),axis.text.y = element_blank(),axis.ticks.x = element_blank(),axis.ticks.y = element_blank())

```
